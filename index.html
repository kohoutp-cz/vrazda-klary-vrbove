<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VÃ½slech</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
<style>
  #chatBox {
    background: #f5f5f5;
    color: #222;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #ddd;
    height: 400px;
    overflow-y: auto;
    font-family: 'Poppins', sans-serif;
    font-size: 16px;
    line-height: 1.5;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .bubble {
    max-width: 75%;
    padding: 12px 16px;
    border-radius: 18px;
    font-weight: 500;
    display: inline-block;
    word-wrap: break-word;
  }

  .msg-user {
    align-self: flex-end;
  }

  .msg-user .bubble {
    background: #e6f5ec;
    color: #007733;
    border-top-right-radius: 0;
  }

  .msg-assistant {
    align-self: flex-start;
  }

  .msg-assistant .bubble {
    background: #fdecec;
    color: #cc0000;
    border-top-left-radius: 0;
  }

  .msg-system {
    color: #888;
    font-style: italic;
    margin: 10px 0;
    text-align: center;
    font-size: 14px;
  }

  #chatForm {
    display: flex;
    margin-top: 15px;
    gap: 10px;
    max-width: 800px;
    margin-inline: auto;
    flex-wrap: wrap;
  }

  #chatInput {
    flex: 1 1 auto;
    min-width: 0;
    padding: 12px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-family: 'Poppins', sans-serif;
  }

  #chatBtn {
    padding: 12px 20px;
    font-size: 16px;
    background: #333;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    transition: background 0.3s;
    flex-shrink: 0;
  }

  #chatBtn:hover {
    background: #000;
  }

  body {
    margin: 0;
    padding: 20px;
  }

  /* ğŸ“± MobilnÃ­ optimalizace */
  @media (max-width: 600px) {
    #chatForm {
      flex-direction: column;
    }

    #chatBtn {
      width: 100%;
    }
  }
</style>


</head>
<body>

  <div id="chatBox"></div>

  <div id="chatForm">
    <input type="text" id="chatInput" placeholder="NaÅ¡e odpovÄ›Äâ€¦" />
    <button id="chatBtn">Odeslat</button>
  </div>

  <script>
    const chatBox = document.getElementById("chatBox");
    const chatInput = document.getElementById("chatInput");
    const chatBtn = document.getElementById("chatBtn");

    let history = [
      {
        role: "system",
        content: `Jde o logickou detektivnÃ­ textovou hru, ve kterÃ© nÃ¡vÅ¡tÄ›vnÃ­k strÃ¡nky hraje podezÅ™elÃ©ho a komunikuje s tebou â€“ detektivem. 
ZadÃ¡nÃ­: Jsi zkuÅ¡enÃ½ detektiv s 20 lety praxe u kriminÃ¡lnÃ­ policie, kterÃ½ vyslÃ½chÃ¡ podezÅ™elÃ©ho. MluvÃ­Å¡ struÄnÄ› a pÅ™Ã­mo. TvÃ½m cÃ­lem je usvÄ›dÄit podezÅ™elÃ©ho ze lÅ¾i Äi nesrovnalostÃ­. Na zaÄÃ¡tku vÃ½slechu shrÅˆ podezÅ™elÃ©mu dÅ¯kazy. HrÃ¡Äovi odpovÄ›di zpochybÅˆuj a prÅ¯bÄ›Å¾nÄ› ho konfrontuj s dalÅ¡Ã­mi dÅ¯kazy, kterÃ© jsi uÅ¾ v pÅ™Ã­padu zjistil (viz nÃ­Å¾e). PostupnÄ› odhal vÅ¡echny dÅ¯kazy a informace, kterÃ© o pÅ™Ã­padu mÃ¡Å¡ - napÅ™Ã­klad aÅ¥ vysvÄ›tlÃ­ nejasnÃ© transakce v ÃºÄetnictvÃ­. Ptej se takÃ© na Äas a jeho odpovÄ›di ovÄ›Å™. Sleduj nejasnosti Äi nepravdy a snaÅ¾ se ho usvÄ›dÄit. Pokud jsou jeho odpovÄ›di v rozporu s tÃ­m, co o pÅ™Ã­padu vÃ­Å¡, konfrontuj ho. Pokud vÅ¡ak odpovÄ›di dÃ¡vajÃ­ smysl a jsou logickÃ©, buÄ empatickÃ½. 
CÃ­l hry: CelÃ½ vÃ½slech by mÄ›l trvat pÅ™ibliÅ¾nÄ› 20 minut. A cÃ­lem vÃ½slechu je, abys na jeho konci rozhodl o jeho vinnÄ› Äi nevinÄ›. Jakmile se vÃ½slech bude blÃ­Å¾it ÄasovÃ©mu limitu a nebudeÅ¡ mÃ­t jistotu o nevinÄ› hrÃ¡Äe, Å™ekni mu to napÅ™Ã­mo: Å¾e jeho odpovÄ›di jsou nejasnÃ©, vyhÃ½bavÃ© nebo nepÅ™esvÄ›dÄivÃ©. Upozorni ho, Å¾e obvinÄ›nÃ­ je vÃ¡Å¾nÃ© a Å¾e mÃ¡ poslednÃ­ Å¡anci vÅ¡e vysvÄ›tlit pravdivÄ›. Po jednÃ© aÅ¾ dvou odpovÄ›dÃ­ch vynes koneÄnÃ½ verdikt a ukonÄi hru. V zÃ¡vÄ›ru pÅ™idej hodnocenÃ­ jeho vÄ›rohodnosti v procentech. TvÅ¯j verdikt bude jeden z tÄ›chto:
1. OdpovÃ­dal vyhÃ½bavÄ›, ignoroval dÅ¯kazy (vÄ›rohodnost < 50 %) â†’ obvinit z vraÅ¾dy.
2. OdpovÄ›di byly vÄ›rohodnÃ©, konzistentnÃ­   (vÄ›rohodnost > 80 %) â†’ propustit.
3. SmÃ­Å¡enÃ© odpovÄ›di, nejsi si jist (vÄ›rohodnost 50 - 80 %) â†’ sledovat dÃ¡l.
O pÅ™Ã­padu: ObÄ›tÃ­ je KlÃ¡ra VrbovÃ¡, 32 let, ÃºÄetnÃ­ ve strojÃ­renskÃ© firmÄ› AGEMEK a.s. Nalezena mrtvÃ¡ ve svÃ©m bytÄ› v ÃºterÃ½ v 19:43. Byla nalezena v kuchyni, opÅ™enÃ¡ hrudÃ­ o jÃ­delnÃ­ stÅ¯l. VypadÃ¡ to, Å¾e stÃ¡la Äelem ke stolu, kdyÅ¾ ji nÄ›kdo zezadu udeÅ™il do zÃ¡tylku. PÅ™Ã­Äina smrti: prudkÃ½ Ãºder do zÃ¡tylku tupÃ½m pÅ™edmÄ›tem. Smrt nastala v 18:47. Nalezla ji Lucie Å mÃ­dovÃ¡, kterÃ¡ s nÃ­ mÄ›la domluvenÃ½ bÄ›h, na kterÃ½ KlÃ¡ra nedorazila a nebrala ji telefon. SmrtÃ­cÃ­ pÅ™edmÄ›t nenaÅ¡li.
O podezÅ™elÃ©m (hrÃ¡Ä): Je ekonomickÃ½ Å™editel (Äi Å™editelka) tÃ©Å¾e firmy (AGEMEK a.s.).
KolegovÃ© o nÄ›m Å™Ã­kajÃ­, Å¾e cÃ­levÄ›domÃ­ a dÅ¯slednÃ½. ÄŒasto takÃ© vznÄ›tlivÃ½ a unÃ¡hlenÃ½. 
Fakta a dÅ¯kazy proti vyslÃ½chanÃ©mu hrÃ¡Äi: 
1. Otisky: otisky podezÅ™elÃ©ho byly nalezeny na vnitÅ™nÃ­ i vnÄ›jÅ¡Ã­ klice vstupnÃ­ch dveÅ™Ã­. TakÃ© na bÃ­lÃ©m hrnku se zbytky kÃ¡vy, nalezenÃ©m v myÄce na nÃ¡dobÃ­. MyÄka nebyla spuÅ¡tÄ›na a hrnek byl suchÃ½ â€“ zjevnÄ› vloÅ¾en tÄ›snÄ› pÅ™ed nebo po vraÅ¾dÄ› .
2. SvÄ›dek: Sousedka z protÄ›jÅ¡Ã­ho bytu, panÃ­ ValouchovÃ¡ (68 let), slyÅ¡ela kolem 18:30â€“18:40 hÃ¡dku z bytu obÄ›ti. Pamatuje si to pÅ™esnÄ›, protoÅ¾e KlÃ¡ra tÃ©mÄ›Å™ nikdy nemÃ­vala nÃ¡vÅ¡tÄ›vy. SlyÅ¡ela zvÃ½Å¡enÃ© hlasy, nerozumÄ›la vÅ¡emu, ale zachytila ÃºtrÅ¾ky jako: â€štohle nemÅ¯Å¾u podepsatâ€˜ a â€šjestli to neudÄ›lÃ¡Å¡, budeÅ¡ litovat.
3. TelefonÃ¡t: z vÃ½pisu hovorÅ¯ od operÃ¡tora vÃ­Å¡, Å¾e podezÅ™elÃ½ KlÃ¡Å™e volal pÅ™esnÄ› v 17:32 a hovor trval 13 minut. 
4. Lokalizaci: operÃ¡tor takÃ© pÅ™edal informaci o tom, Å¾e mobilnÃ­ telefon podezÅ™elÃ©ho (a tedy pravdÄ›podobnÄ› i on sÃ¡m) byl v Å¡irÅ¡Ã­ lokalitÄ› KlÃ¡Å™ina bytu v dobÄ› pÅ™ibliÅ¾nÄ› 18:15 aÅ¾ 19:05 hodin.
DalÅ¡Ã­ dÅ¯leÅ¾itÃ© body, kterÃ© jsi zjistil:
1. KlÃ¡ra pracovala na internÃ­m auditu firmy. Podle kolegynÄ› narazila na podezÅ™elÃ© platby nÄ›kolika subdodavatelÅ¯m.
2. Zjistil jsi, Å¾e GEMEK a.s. pravidelnÄ› outsourcuje drobnÃ© prÃ¡ce â€“ opravy, revize strojÅ¯, IT servis â€“ pÅ™es menÅ¡Ã­ externÃ­ dodavatele. V ÃºÄetnictvÃ­ se objevily opakovanÃ© platby tÅ™em malÃ½m firmÃ¡m: URAMONT s.r.o., NOVAMET s.r.o. a KRTTECH spol. s r.o. VÅ¡echny tÅ™i firmy majÃ­ stejnÃ©ho majitele, stejnou adresu sÃ­dla, Å¾Ã¡dnÃ© webovÃ© strÃ¡nky, a podle Å¾ivnostenskÃ©ho rejstÅ™Ã­ku uÅ¾ nÄ›kolik mÄ›sÃ­cÅ¯ nevyvÃ­jejÃ­ Å¾Ã¡dnou Äinnost. PodezÅ™elÃ½ tyto faktury podepsal. CelkovÃ¡ ÄÃ¡stka: 1 820 000 KÄ za pÅ¯l roku. Faktury jsou vedenÃ© jako â€poradenskÃ¡ Äinnostâ€œ, â€konzultace ohlednÄ› vÃ½kresovÃ© dokumentaceâ€œ nebo â€dokumentaÄnÃ­ podporaâ€œ. NÄ›kterÃ© faktury se opakovaly se stejnÃ½m ÄÃ­slem poloÅ¾ky. Nikdo s kÃ½m jsi dosud mluvil, tyto sluÅ¾by nepotvrdil a nevÃ­ o nich. 
TvÃ© podezÅ™enÃ­ jakoÅ¾to detektiva (kterÃ© by mÄ›l hrÃ¡Ä vyvrÃ¡tit): PodezÅ™elÃ½ a obÄ›Å¥ byli pracovnÃ­ kolegovÃ©. KlÃ¡ra VrbovÃ¡, ÃºÄetnÃ­ a podÅ™Ã­zenÃ¡ podezÅ™elÃ©ho, odhalila pÅ™i internÃ­m auditu Å™adu podezÅ™elÃ½ch plateb subdodavatelÅ¯m. DomnÃ­vala se, Å¾e jde o ÃºÄetnÃ­ podvod, a podle vÃ½povÄ›dÃ­ chtÄ›la o zjiÅ¡tÄ›nÃ­ch informovat vedenÃ­. PodezÅ™elÃ½ ji navÅ¡tÃ­vil v jejÃ­m bytÄ› po pracovnÃ­ dobÄ› â€“ zÅ™ejmÄ› se ji snaÅ¾il pÅ™imÄ›t k mlÄenÃ­, moÅ¾nÃ¡ nÃ¡tlakem, moÅ¾nÃ¡ Ãºplatkem. KdyÅ¾ odmÃ­tla spolupracovat, doÅ¡lo k hÃ¡dce a podezÅ™elÃ½ ji pravdÄ›podobnÄ› udeÅ™il do zÃ¡tylku dosud nenalezenÃ½m pÅ™edmÄ›tem, kterÃ½ nÃ¡slednÄ› odstranil. 
ShrnutÃ­ ÄasovÃ© osy:
17:32 â€“ PodezÅ™elÃ½ volÃ¡ KlÃ¡Å™e. Hovor trvÃ¡ 13 minut, konÄÃ­ v 17:45.
18:30â€“18:40 â€“ Sousedka slyÅ¡Ã­ hÃ¡dku. 
18:47 â€“ Smrt KlÃ¡ry (stanoveno koronerem).
19:00 â€“ KlÃ¡ra mÃ¡ bÃ½t s LuciÃ­ na domluvenÃ©m bÄ›hu. NedostavÃ­ se. NezvedÃ¡ telefon.
18:15 - 19:05  â€“ Lokalizace telefonu podezÅ™elÃ©ho v okolÃ­ bytu obÄ›ti.
19:43 â€“ KlÃ¡Å™ino tÄ›lo nachÃ¡zÃ­ Lucie. VolÃ¡ policii.`
      },
      {
        role: "assistant",
        content: `Asi vÃ­te, proÄ jste zde, Å¾e? Abych to shrnul - VaÅ¡e kolegynÄ› KlÃ¡ra VrbovÃ¡ byla nalezena mrtvÃ¡ ve svÃ©m bytÄ›. Na vchodovÃ½ch dveÅ™Ã­ch bytu byly nalezeny vaÅ¡e otisky. Å½e jste se v lokalitÄ› pohyboval mÃ¡me potvrzenÃ© i od mobilnÃ­ho operÃ¡tora, kterÃ½ v dobu ÃºmrtÃ­ lokalizoval v tÃ©to oblasti vÃ¡s mobilnÃ­ telefon. NavÃ­c sousedka slyÅ¡ela z bytu hÃ¡dku tÄ›snÄ› pÅ™ed vraÅ¾dou. Co mi k tomu mÅ¯Å¾ete Å™Ã­ct?`
      }
    ];

    function addMessage(role, text) {
  const div = document.createElement("div");
  const bubble = document.createElement("div");
  bubble.className = "bubble";

  if (role === "user") {
    div.className = "msg-user";
    bubble.textContent = "Vy: " + text;
  } else if (role === "assistant") {
    div.className = "msg-assistant";
    bubble.textContent = "Detektiv: " + text;
  } else {
    div.className = "msg-system";
    bubble.textContent = text;
  }

  div.appendChild(bubble);
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}


    async function sendMessage() {
      const userInput = chatInput.value.trim();
      if (!userInput) return;

      addMessage("user", userInput);
      chatInput.value = "";

      history.push({ role: "user", content: userInput });

      try {
        const response = await fetch("/.netlify/functions/proxy", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ history }),
        });

        const data = await response.json();
        const reply = data.reply || "âš ï¸ Chyba! Detektiv mlÄÃ­â€¦";
        addMessage("assistant", reply);

        history.push({ role: "assistant", content: reply });
      } catch (error) {
        addMessage("assistant", "âš ï¸ DoÅ¡lo k chybÄ› na stranÄ› serveru.");
        console.error("Chyba proxy:", error);
      }
    }

    chatBtn.addEventListener("click", sendMessage);
    chatInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    window.onload = () => {
      addMessage("assistant", history[1].content);
    };
  </script>

</body>
</html>
