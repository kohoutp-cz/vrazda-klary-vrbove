<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Výslech</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
  #chatBox {
    background: #f5f5f5;
    color: #222;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #ddd;
    height: 400px;
    overflow-y: auto;
    font-family: 'Poppins', sans-serif;
    font-size: 16px;
    line-height: 1.5;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .bubble {
    max-width: 75%;
    padding: 12px 16px;
    border-radius: 18px;
    font-weight: 500;
    display: inline-block;
    word-wrap: break-word;
  }

  .msg-user {
    align-self: flex-end;
  }

  .msg-user .bubble {
    background: #e6f5ec;
    color: #007733;
    border-top-right-radius: 0;
  }

  .msg-assistant {
    align-self: flex-start;
  }

  .msg-assistant .bubble {
    background: #fdecec;
    color: #cc0000;
    border-top-left-radius: 0;
  }

  .msg-system {
    color: #888;
    font-style: italic;
    margin: 10px 0;
    text-align: center;
    font-size: 14px;
  }

  #chatForm {
    display: flex;
    margin-top: 15px;
    gap: 10px;
    max-width: 800px;
    margin-inline: auto;
  }

  #chatInput {
    flex: 1;
    padding: 12px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-family: 'Poppins', sans-serif;
  }

  #chatBtn {
    padding: 12px 20px;
    font-size: 16px;
    background: #333;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    transition: background 0.3s;
  }

  #chatBtn:hover {
    background: #000;
  }

  body {
    background: #fff;
    margin: 0;
    padding: 20px;
  }
</style>

</head>
<body>

  <div id="chatBox"></div>

  <div id="chatForm">
    <input type="text" id="chatInput" placeholder="Naše odpověď…" />
    <button id="chatBtn">Odeslat</button>
  </div>

  <script>
    const chatBox = document.getElementById("chatBox");
    const chatInput = document.getElementById("chatInput");
    const chatBtn = document.getElementById("chatBtn");

    let history = [
      {
        role: "system",
        content:
          "Jsi zkušený detektiv s 20 lety praxe u kriminální policie. Obětí je žena jménem Klára Vrbová, nalezená mrtvá ve vaně. Máš tyto důkazy:
– otisky podezřelého na skle koupelny,
– svědectví sousedky o hádce,
– nesedící alibi (mobil u místa činu),
– SMS: „Jestli dnes nedorazím, volej policii.“

Na začátku výslechu podezřelému důkazy shrň. Pak ho začni vyslýchat. Pokud odpovídá vyhýbavě nebo popírá důkazy, zvyšuj tlak. Pokud odpovědi dávají smysl, zvaž empatii.

Po 10 minutách výslechu se musíš rozhodnout:
1. Odpovídal vyhýbavě, ignoroval důkazy → obvinit.
2. Odpovědi byly věrohodné, konzistentní → propustit.
3. Smíšené odpovědi → sledovat dál.

Na konci řekni verdikt. Tím hra končí."
      },
      {
        role: "assistant",
        content:
          "Zřejmě víte, proč jste zde, že? Máme stopy, které ukazují, že máte něco společného se smrtí Kláry Vrbové. Máme vaše otisky na skle v koupelně, kde byla nalezena mrtvá. Sousedka vás slyšela hádat se s Klárou tu noc. Váš mobil se připojil ke stanici pár set metrů od jejího bytu. A pak je tu ta ještě zpráva od Kláry kamarádce Lucii, se kterou se měla sejít: „Jestli dnes nedorazím, volej policii“. Co mi k tomu můžete říct?"
      }
    ];

    function addMessage(role, text) {
  const div = document.createElement("div");
  const bubble = document.createElement("div");
  bubble.className = "bubble";

  if (role === "user") {
    div.className = "msg-user";
    bubble.textContent = "Vy: " + text;
  } else if (role === "assistant") {
    div.className = "msg-assistant";
    bubble.textContent = "Detektiv: " + text;
  } else {
    div.className = "msg-system";
    bubble.textContent = text;
  }

  div.appendChild(bubble);
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}


    async function sendMessage() {
      const userInput = chatInput.value.trim();
      if (!userInput) return;

      addMessage("user", userInput);
      chatInput.value = "";

      history.push({ role: "user", content: userInput });

      try {
        const response = await fetch("/.netlify/functions/proxy", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ history }),
        });

        const data = await response.json();
        const reply = data.reply || "⚠️ Detektiv mlčí…";
        addMessage("assistant", reply);

        history.push({ role: "assistant", content: reply });
      } catch (error) {
        addMessage("assistant", "⚠️ Došlo k chybě na straně serveru.");
        console.error("Chyba proxy:", error);
      }
    }

    chatBtn.addEventListener("click", sendMessage);
    chatInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    window.onload = () => {
      addMessage("assistant", history[1].content);
    };
  </script>

</body>
</html>
